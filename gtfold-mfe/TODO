Partition Function
==================

 - fast inner loops optimization
 - factor in dangling energies
